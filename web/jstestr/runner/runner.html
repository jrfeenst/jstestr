<!DOCTYPE html>
<html>
    <head>
        <title>Test Runner</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <style>
            html, body, #graphicalLogger {
                padding: 0;
                margin: 0;
                outline: 0;
                border: 0;
                width: 100%;
                height: 100%;
            }
        </style>
    </head>
    <body>
        <div id="graphicalLogger"></div>
        
        <script src="../../require.js"></script>
        <script type="text/javascript">
            require.config({baseUrl: "../../"});
            
            require([
                "jstestr/runner/consoleLogger",
                "jstestr/runner/graphicalLogger",
                "jstestr/test"
            ], function (consoleLogger, graphicalLogger, test) {
                
                consoleLogger.listen(test);
                graphicalLogger.listen(test, document.getElementById("graphicalLogger"));
                
                // parse the query string
                var query = location.search.substring(1, location.search.length);
                var args = query.split("&");

                var modules = [];
                var suite;
                var suiteTest;
                var config = {};
                var run = true;

                for (var i in args) {
                    var arg = args[i].split("=");
                    var key = arg[0];
                    var value = arg[1];
                    switch (key.toLowerCase()) {
                        case "module":
                            modules.push(value);
                            break;
                        case "suite":
                            suite = unescape(value);
                            break;
                        case "test":
                            suiteTest = unescape(value);
                            break;
                        case "config":
                            config = JSON.parse(value);
                            break;
                        case "run":
                            run = value === "true";
                        default:
                            console.error("Unknown argument: " + args[i]);
                            break;
                    }
                }

                require.config(config);

                require(modules, function () {
                    if (run) {
                        if (suite) {
                            test.runSuite(suite);
                        } else if (suiteTest) {
                            var parts = suiteTest.split(":");
                            test.runTest(parts[0], parts[1]);
                        } else {
                            test.runAll();
                        }
                    } 
                });
            });
        </script>
    </body>
</html>
